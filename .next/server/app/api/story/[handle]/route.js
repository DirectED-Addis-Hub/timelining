(()=>{var e={};e.id=850,e.ids=[850],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1204:e=>{"use strict";e.exports=require("string_decoder")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},2786:()=>{},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4985:e=>{"use strict";e.exports=require("dns")},5591:e=>{"use strict";e.exports=require("https")},5773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>T,serverHooks:()=>I,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>d});var o=r(612),n=r(5705),i=r(4336),a=r(621),c=r(5784),u=r(8285);async function p(e,{params:t}){let{handle:r}=await t,s=(await (0,c.Tr)()).session({database:"neo4j"});u.v.info(`Fetching connected nodes for participant handle: ${r}`);try{let e=(await s.run(`
      MATCH (p:Participant {handle: $handle})<-[:SENT_BY]-(e:Entry)
      OPTIONAL MATCH (e)-[:HAS_TEXT]->(t:TextContent)
      OPTIONAL MATCH (e)-[:HAS_CAPTION]->(cap:CaptionContent)
      OPTIONAL MATCH (e)-[:HAS_ENTITY]->(en:Entity)
      OPTIONAL MATCH (e)-[:HAS_PHOTO]->(pht:Photo)
      OPTIONAL MATCH (e)-[:HAS_VOICE]->(vn:Voice)
      OPTIONAL MATCH (e)-[:HAS_VIDEO]->(vid:Video)
      OPTIONAL MATCH (e)-[:HAS_VIDEO_NOTE]->(vidnote:VideoNote)
      OPTIONAL MATCH (e)-[:FROM_CHAT]->(chat:TelegramChat)

      RETURN 
        count(DISTINCT e) as entries,
        count(DISTINCT t) as textContents,
        count(DISTINCT cap) as captionContents,
        count(DISTINCT en) as entities,
        count(DISTINCT pht) as photos,
        count(DISTINCT vn) as voices,
        count(DISTINCT vid) as videos,
        count(DISTINCT vidnote) as videoNotes,
        count(DISTINCT chat) as chats
      `,{handle:r})).records[0],t={entries:e.get("entries").toInt(),textContents:e.get("textContents").toInt(),captionContents:e.get("captionContents").toInt(),entities:e.get("entities").toInt(),photos:e.get("photos").toInt(),voices:e.get("voices").toInt(),videos:e.get("videos").toInt(),videoNotes:e.get("videoNotes").toInt(),chats:e.get("chats").toInt()};return a.NextResponse.json(t)}catch(e){if(u.v.error("Failed to fetch participant connections",{error:e}),e instanceof Error)return a.NextResponse.json({error:e.message},{status:500});return a.NextResponse.json({error:"Unknown error occurred"},{status:500})}finally{await s.close()}}async function d(){return new a.NextResponse("Method Not Allowed",{status:405})}let T=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/story/[handle]/route",pathname:"/api/story/[handle]",filename:"route",bundlePath:"app/api/story/[handle]/route"},resolvedPagePath:"C:\\Users\\Tobias Fechner\\Documents\\2_Work\\prisma\\timelining\\src\\app\\api\\story\\[handle]\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:v,serverHooks:I}=T;function h(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:v})}},5784:(e,t,r)=>{"use strict";let s;r.d(t,{Tr:()=>p,vZ:()=>u});var o=r(3778),n=r(8285);let i=process.env.NEO4J_URI||"bolt://localhost:7687",a=process.env.NEO4J_USERNAME||"neo4j",c=process.env.NEO4J_PASSWORD||"neo4jtesting";function u(){return s||(n.v.info(`Connecting to Neo4j at ${i} with user ${a}`),s=o.Ay.driver(i,o.Ay.auth.basic(a,c))),s}async function p(){n.v.info("Initializing Neo4j connection...");let e=u();try{n.v.info("Verifying connection to Neo4j...");let t=await e.verifyConnectivity();return n.v.info("Server Info:",t),e}catch(t){throw n.v.error(`Failed to initialize Neo4j driver: ${t instanceof Error?t.message:"Unknown error"}`),await e.close(),t}}},7910:e=>{"use strict";e.exports=require("stream")},8285:(e,t,r)=>{"use strict";r.d(t,{v:()=>o});var s=r(7911);let o=(0,s.createLogger)({level:"info",format:s.format.combine(s.format.timestamp(),s.format.json()),transports:[new s.transports.Console]})},8354:e=>{"use strict";e.exports=require("util")},8506:()=>{},9021:e=>{"use strict";e.exports=require("fs")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[877,911,778],()=>r(5773));module.exports=s})();